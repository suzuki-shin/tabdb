(function() {
  var build, files, fs, glob, js2c, quote, tests, _;

  js2c = require('../lib/js2coffee');

  glob = require('glob').globSync;

  fs = require('fs');

  _ = require('underscore');

  build = js2c.build;

  files = glob('./test/features/*.js');

  tests = {};

  quote = function(str) {
    var char;
    char = "     | ";
    return char + str.replace(/\n/g, "\n" + char);
  };

  _.each(files, function(f) {
    return tests[f] = function() {
      var control, input, output;
      input = fs.readFileSync(f).toString().trim();
      output = build(input).trim();
      control = fs.readFileSync(f.replace('.js', '.coffee')).toString().trim();
      if (output === control) {
        return true;
      } else {
        console.log("     Output:");
        console.log(quote(output));
        console.log("     Expected:");
        console.log(quote(control));
        return false;
      }
    };
  });

  _.each(tests, function(test, name) {
    var result;
    try {
      result = test();
      if (result) {
        return console.log("[ OK ] " + name);
      } else {
        return console.log("[FAIL] " + name);
      }
    } catch (e) {
      console.log("[ERR ] " + name);
      return console.log(e.message);
    }
  });

}).call(this);
